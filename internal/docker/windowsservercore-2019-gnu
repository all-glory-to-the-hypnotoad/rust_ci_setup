# syntax=docker/dockerfile:1

# Select base image
FROM cirrusci/windowsservercore:visualstudio2022-2022.06.23

SHELL ["powershell.exe", "-NoLogo", "-NoProfile", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';"]

RUN choco install -y rustup.install; \
    Import-Module $env:ChocolateyInstall\helpers\chocolateyProfile.psm1; \
    refreshenv; \
    rustup toolchain add beta; \
    rustup component add rustfmt clippy; \
    [Environment]::SetEnvironmentVariable('Path', $env:Path + ';C:\Program Files\LLVM\bin', [EnvironmentVariableTarget]::Machine); \
    [Environment]::SetEnvironmentVariable('Path', $env:Path + ';C:\Program Files\LLVM\bin', [EnvironmentVariableTarget]::Process); \
    [Environment]::SetEnvironmentVariable('Path', $env:Path + ';C:\Program Files\LLVM\bin', [EnvironmentVariableTarget]::User); \
    Remove-Item C:\ProgramData\chocolatey\logs\* -Force -Recurse ; \
    Remove-Item $Env:localappdata\Nuget\Cache\*nupkg ; \
    Remove-Item $Env:temp\* -Force -Recurse
